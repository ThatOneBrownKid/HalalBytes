<div class="image-container" style="position: relative; width: 100%; height: 40vh; overflow: hidden;">
  <% if @restaurant.images.attached? %>
    <%= image_tag @restaurant.images.first.variant(resize_to_fill: [1000, 200]), class: "card-img", alt: "Restaurant Image", style: "object-fit: cover; width: 100%; height: 100%;" %>
  <% else %>
    <%= image_tag "default-restaurant-image.jpg", class: "card-img", alt: "Restaurant Image", style: "object-fit: cover; width: 100%; height: 100%;" %> 
  <% end %>
  <div class="restaurant-info d-inline" style="position: absolute; bottom: 5%; left: 1%;">
    <div class="restaurant-name" style="color: white; font-size: 40px; font-weight: bold;">
      <%= @restaurant.name %>
    </div>
    <div class="restaurant-rating d-inline" style="font-size: 20px; font-weight: bold;">
        <% @restaurant.overall_rating.to_i.times do%>
          <i class="bi bi-star-fill red"></i>
        <% end %>   
        <% (5-@restaurant.overall_rating.to_i).times do%>
          <i class="bi bi-star-fill gray"></i>
        <% end %>
        <div class="d-inline text-white">
          <%=@restaurant.overall_rating%>
          <i class="bi bi-dot"></i>
        </div>
        <div class="restaurant-open-close d-inline" style="font-size: 20px; font-weight: bold;">
          <% if @restaurant.open? %>
            <span style="color: green;">Open</span>
          <% else %>
            <span style="color: red;">Closed</span>
          <% end %>
        </div>
    </div>
  </div>
  <div class="gallery-button" style="position: absolute; bottom: 5%; right: 1%;">
  <% if current_user.admin? %>
    <%= form_with(model: @restaurant, local: true, html: { multipart: true }) do |form| %>
      <label for="image-upload" class="btn btn-secondary image-upload-btn">
        <i class="bi bi-cloud-upload"></i> <p class="upload d-inline">Upload</p>
        <%= form.file_field :images, multiple: true, class: 'form-control', id: 'image-upload', style: 'display: none;', onchange: 'previewImages()' %>
      </label>
      <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="uploadModalLabel">Upload Images</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="imagePreviews"></div>
            </div>
            <div class="modal-body">
              <p>Would you like to upload <span id="fileCount"></span> file(s)?</p>
            </div>
            <div class="modal-footer">
              <%= form.submit 'Upload', class: 'btn btn-primary', id: 'uploadFilesBtn', disabled: true %>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
  </div>
  
</div>

<div class="container-fluid pt-3">
  <div class="row">
    <div class="col-md-3">
      <div class="rounded p-3 border">
        <div class="d-block text-black" id="Resturant Address">
          <p class="d-inline" style="font-weight: bold;"> Address: </p> 
          <%=@restaurant.address%>
        </div>
        <div class="d-block text-black" id="Resturant Address">
          <p class="d-inline" style="font-weight: bold;"> Hours: </p> 
          <span class="current-label" id="current-day" style="font-style: italic;"></span>
          <span> <%= @restaurant.hours(Time.now.strftime("%A").downcase) %></span>
          <span class="dropdown" onclick="toggleHours()"> 
            <i id="dropdown-icon" class="bi bi-caret-down-fill"></i> 
          </span>
          <div class="d-block text-black d-none" id="RestaurantHours">
            <div class="d-block text-black">
              <span class="day-label">Sunday:</span>
              <span class="hours"><%= @restaurant.hours("Sunday") %></span>
            </div>
            <div class="d-block text-black">
              <span class="day-label">Monday:</span>
              <span class="hours"><%= @restaurant.hours("Monday") %></span>
            </div>
            <div class="d-block text-black">
              <span class="day-label">Tuesday:</span>
              <span class="hours"><%= @restaurant.hours("Tuesday") %></span>
            </div>
            <div class="d-block text-black">
              <span class="day-label">Wednesday:</span>
              <span class="hours"><%= @restaurant.hours("Wednesday") %></span>
            </div>
            <div class="d-block text-black">
              <span class="day-label">Thursday:</span>
              <span class="hours"><%= @restaurant.hours("Thursday") %></span>
            </div>
            <div class="d-block text-black">
              <span class="day-label">Friday:</span>
              <span class="hours"><%= @restaurant.hours("Friday") %></span>
            </div>
            <div class="d-block text-black">
              <span class="day-label">Saturday:</span>
              <span class="hours"><%= @restaurant.hours("Saturday") %></span>
            </div>
          </div>
          <div class="d-block text-black" id="Resturant Phone">
            <p class="d-inline" style="font-weight: bold;"> Phone: </p> 
            <%= @restaurant.phone %>
          </div><div class="d-block text-black" id="Resturant Website">
            <p class="d-inline" style="font-weight: bold;"> Website: </p> 
            <a href="<%= @restaurant.website %>" target="_blank"><%= @restaurant.website %></a>
          </div>



      </div>
    </div>
  </div>
</div>


<div class="modal" tabindex="-1" id="imagePreviewModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Image Previews</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="imagePreviews"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="uploadImages()">Confirm</button>
      </div>
    </div>
  </div>
</div>


<style>
.star-rating {
  font-size: 50px;
}

.star {
  display: inline-block;
  font-size: inherit;
  color: #FFFFFF; /* Default star color */
}

.star.filled {
  color: #FFAC2D; /* Filled star color */
}

.red{
  color: #DC3545;
}

.gray{
  color: #D3D3D3;
}
.dropdown {
  display: inline-block;
  text-align: right;
  margin-right: 10px; 
  cursor: pointer;
}

.current-label {
  display: inline-block;
  width: 66px; 
  text-align: right;
  margin-right: 10px; 

}

.day-label {
  display: inline-block;
  width: 120px; 
  text-align: right;
  margin-right: 10px;
}

.hours {
  display: inline-block;
}

/* CSS to add fade-in animation */
.day-label,
.hours {
  opacity: 0; /* Start with 0 opacity */
  transition: opacity 0.5s ease; /* Add a transition effect */
}

/* Apply the animation to each row individually */
.day-label:nth-child(1),
.hours:nth-child(1) {
  animation: fadeIn 0.5s ease 0.5s 1 normal forwards;
}

.day-label:nth-child(2),
.hours:nth-child(2) {
  animation: fadeIn 0.5s ease 1s 1 normal forwards;
}

.image-upload-btn:hover .bi-cloud-upload {
  color: DeepSkyBlue!important;
}

.image-upload-btn:hover .upload {
  color: DeepSkyBlue!important;
}

</style>


<script>
    // Function to toggle the icon, div visibility, and apply animation
    function toggleHours() {
      const icon = document.getElementById("dropdown-icon");
      const hoursDiv = document.getElementById("RestaurantHours");

      if (icon.classList.contains("bi-caret-down-fill")) {
        // Toggle to left icon
        icon.classList.remove("bi-caret-down-fill");
        icon.classList.add("bi-caret-left-fill");

        // Toggle the visibility of the div
        hoursDiv.classList.remove("d-none");

        // Trigger animation for each row
        const dayLabels = hoursDiv.querySelectorAll(".day-label");
        const hoursSpans = hoursDiv.querySelectorAll(".hours");

        dayLabels.forEach((label, index) => {
          setTimeout(() => {
            label.style.opacity = "1";
            hoursSpans[index].style.opacity = "1";
          }, 10 * index); // Adjust the delay as needed
        });
      } else {
        // Toggle to down icon, hide div, and reset opacity
        icon.classList.remove("bi-caret-left-fill");
        icon.classList.add("bi-caret-down-fill");

        // Toggle the visibility of the div
        hoursDiv.classList.add("d-none");

        // Reset opacity to 0 for all rows
        const dayLabels = hoursDiv.querySelectorAll(".day-label");
        const hoursSpans = hoursDiv.querySelectorAll(".hours");

        dayLabels.forEach((label) => {
          label.style.opacity = "0";
        });

        hoursSpans.forEach((hours) => {
          hours.style.opacity = "0";
        });
      }
    }
  </script>
<script>
  const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  const currentDayIndex = new Date().getDay();
  const currentDayName = daysOfWeek[currentDayIndex];
  const currentDayWithColon = currentDayName + ":";

  const currentDayElement = document.getElementById("current-day");
  currentDayElement.textContent = currentDayWithColon;
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>

<script>
  $(document).ready(function() {
  // Enable the carousel functionality
  $("#imageCarousel").carousel();

  // Handle carousel navigation
  $(".carousel-control-prev").click(function() {
    $("#imageCarousel").carousel("prev");
  });

  $(".carousel-control-next").click(function() {
    $("#imageCarousel").carousel("next");
  });

  // Open modal when file input changes
  $("#image-upload").change(function() {
    const fileCount = $(this)[0].files.length;
    $("#fileCount").text(fileCount);
    $("#uploadModal").modal("show");
  });

  // Enable/disable upload button based on file selection
  $("#image-upload").on("input", function() {
    const fileCount = $(this)[0].files.length;
    const uploadBtn = $("#uploadFilesBtn");
    if (fileCount > 0) {
      uploadBtn.prop("disabled", false);
    } else {
      uploadBtn.prop("disabled", true);
    }
  });
});
</script>

<script>
function previewImages() {
    const input = document.getElementById('image-upload');
    const previewDiv = document.getElementById('imagePreviews');
    previewDiv.innerHTML = ''; // Clear previous previews

    if (input.files && input.files[0]) {
        Array.from(input.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function (e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.width = '100px';
                img.style.marginRight = '10px';
                previewDiv.appendChild(img);
            }
            reader.readAsDataURL(file);
        });

        // Update the file count
        document.getElementById('fileCount').textContent = input.files.length;

        // Enable the upload button
        document.getElementById('uploadFilesBtn').disabled = false;

        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('uploadModal'));
        modal.show();
    }
}
</script>